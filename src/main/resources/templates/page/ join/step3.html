<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Tmoney 교통복지플랫폼"/>
  <meta name="keywords" content="Tmoney 교통복지플랫폼"/>
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Tmoney 교통복지플랫폼" />
  <meta property="og:description" content="Tmoney 교통복지플랫폼" />

  <title th:text="${pageTitle} ?: 'Tmoney 교통복지플랫폼'">Tmoney 교통복지플랫폼</title>

  <!-- 정적 리소스: /static/css/** → /css/** -->
  <link rel="stylesheet" th:href="@{/css/vendor/aos.css}" />
  <link rel="stylesheet" th:href="@{/css/vendor/swiper-bundle.min.css}" />
  <link rel="stylesheet" th:href="@{/css/index.css}" />
  <link rel="stylesheet" th:href="@{/css/page/page.css}" />
</head>
<body>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    if (window.AOS && !window.__aosInited) {
      AOS.init(); /* 옵션 필요 시 { duration: 600, once: true } */
      window.__aosInited = true;
    }
  });
</script>

<p id="skip-nav">
  <a href="#contents">본문으로 바로가기</a>
  <a href="#gnb1">주메뉴 바로가기</a>
</p>

<th:block th:replace="~{component/header :: siteHeader}"></th:block>

<main id="contents">
  <section class="section">
    <div class="container fluid">
      <div class="join-wrap">
        <div class="join-header">
          <h2 class="section-title">회원가입</h2>
          <ol class="step-box" role="list" aria-label="회원가입 단계">
            <li>
              <div class="circle" aria-hidden="true">
                <span>1</span>
                <i class="icon document"></i>
              </div>
              <p>약관동의</p>
            </li>
            <li>
              <div class="circle" aria-hidden="true">
                <span>2</span>
                <i class="icon lock"></i>
              </div>
              <p>본인인증</p>
            </li>
            <li aria-current="step" class="active">
              <div class="circle" aria-hidden="true">
                <span>3</span>
                <i class="icon write"></i>
              </div>
              <p>정보입력 <span class="sr-only">(현재 단계)</span></p>
            </li>
            <li>
              <div class="circle" aria-hidden="true">
                <span>4</span>
                <i class="icon check"></i>
              </div>
              <p>가입완료</p>
            </li>
          </ol>
        </div>
      </div>
    </div>
    <div class="container size-xsm">
      <div class="join-wrap">
        <div class="form-box">
          <form action="" method="post" novalidate>
            <!-- 아이디 -->
            <div>
              <label class="field-title" for="userId">
                아이디 <span class="color-error" aria-hidden="true">*</span>
              </label>
              <div class="flex gap8">
                <input id="userId" name="userId" type="text" class="text-field size-lg"
                      placeholder="아이디를 입력해주세요."
                      autocomplete="username"
                      required aria-required="true"
                      minlength="6" maxlength="15"
                      pattern="^[a-z][a-z0-9._]{5,14}$"
                      aria-describedby="userIdHelp">
                <button type="button" class="btn btn-darkgray size-lg" aria-describedby="userIdHelp">중복확인</button>
              </div>
              <p class="guide-text" id="userIdHelp">
                ※ 영문소문자, 숫자, 일부 특수문자(._) 6~15자 (시작은 영문자)
              </p>
            </div>

            <!-- 비밀번호 -->
            <div>
              <label class="field-title" for="password">
                비밀번호 <span class="color-error" aria-hidden="true">*</span>
              </label>
              <input id="password" name="password" type="password" class="text-field size-lg"
                    placeholder="비밀번호를 입력해주세요."
                    autocomplete="new-password"
                    required aria-required="true"
                    minlength="8" maxlength="20"
                    aria-describedby="pwdHelp1 pwdHelp2">
              <p class="guide-text" id="pwdHelp1">※ 영문, 숫자, 특수문자 중 2가지 이상 혼합 8~20자 (영문자 필수)</p>
              <p class="guide-text" id="pwdHelp2">※ 아이디가 포함된 비밀번호는 사용할 수 없습니다.</p>
            </div>

            <!-- 비밀번호 확인 -->
            <div>
              <label class="field-title" for="passwordConfirm">
                비밀번호 확인 <span class="color-error" aria-hidden="true">*</span>
              </label>
              <input id="passwordConfirm" name="passwordConfirm" type="password" class="text-field size-lg"
                    placeholder="비밀번호를 다시 입력해주세요."
                    autocomplete="new-password"
                    required aria-required="true">
            </div>

            <!-- 휴대전화번호 -->
            <div>
              <p class="field-title">휴대전화번호 <span class="color-error" aria-hidden="true">*</span></p>
              <fieldset>
                <legend class="sr-only">휴대전화번호 *</legend>
                <div class="flex align-center gap8">
                  <label for="mobile1" class="sr-only">국번</label>
                  <input id="mobile1" name="mobile1" type="text" class="text-field size-lg"
                        value="010" readonly aria-readonly="true"
                        inputmode="numeric" pattern="[0-9]*">
                  <span class="flex-bar" aria-hidden="true">-</span>

                  <label for="mobile2" class="sr-only">중간번호</label>
                  <input id="mobile2" name="mobile2" type="text" class="text-field size-lg"
                        value="1234" readonly aria-readonly="true"
                        inputmode="numeric" pattern="[0-9]*">
                  <span class="flex-bar" aria-hidden="true">-</span>

                  <label for="mobile3" class="sr-only">끝번호</label>
                  <input id="mobile3" name="mobile3" type="text" class="text-field size-lg"
                        value="5678" readonly aria-readonly="true"
                        inputmode="numeric" pattern="[0-9]*">
                </div>
              </fieldset>
            </div>

            <!-- 전화번호 -->
            <div>
              <p class="field-title">전화번호</p>
              <fieldset>
                <legend class="sr-only">전화번호</legend>
                <div class="flex align-center gap8">
                  <label for="tel1" class="sr-only">지역번호</label>
                  <input id="tel1" name="tel1" type="text" class="text-field size-lg"
                        value="010" readonly aria-readonly="true"
                        inputmode="numeric" pattern="[0-9]*">
                  <span class="flex-bar" aria-hidden="true">-</span>

                  <label for="tel2" class="sr-only">중간번호</label>
                  <input id="tel2" name="tel2" type="text" class="text-field size-lg"
                        value="1234" readonly aria-readonly="true"
                        inputmode="numeric" pattern="[0-9]*">
                  <span class="flex-bar" aria-hidden="true">-</span>

                  <label for="tel3" class="sr-only">끝번호</label>
                  <input id="tel3" name="tel3" type="text" class="text-field size-lg"
                        value="5678" readonly aria-readonly="true"
                        inputmode="numeric" pattern="[0-9]*">
                </div>
              </fieldset>
            </div>

            <!-- 이메일 -->
            <div>
              <label class="field-title" for="emailId">이메일</label>
              <div class="flex align-center gap8">
                <input id="emailId" name="emailId" type="text" class="text-field size-lg"
                      placeholder="이메일 아이디를 입력해주세요."
                      autocomplete="email" aria-describedby="emailHelp">
                <span class="flex-bar" aria-hidden="true">@</span>
                <input id="emailDomainManual" name="emailDomainManual" type="text" class="text-field size-lg"
                      placeholder="직접 입력 (선택)">
              </div>

              <!-- 도메인 드롭다운 -->
              <div class="dropdown size-lg" data-name="emailDomain">
                <button type="button"
                        id="emailDomainBtn"
                        class="dropdown_button"
                        aria-haspopup="listbox"
                        aria-expanded="false"
                        aria-controls="emailDomainList"
                        aria-label="이메일 주소 선택 드롭다운">
                  <span class="dropdown_value" data-placeholder="이메일주소 선택">이메일주소 선택</span>
                </button>

                <ul class="dropdown_list" id="emailDomainList" role="listbox" tabindex="-1" aria-labelledby="emailDomainBtn">
                  <li role="option" class="dropdown_option" data-value="naver.com" aria-selected="false">naver.com</li>
                  <li role="option" class="dropdown_option" data-value="daum.net"  aria-selected="false">daum.net</li>
                  <li role="option" class="dropdown_option" data-value="nate.com"  aria-selected="false">nate.com</li>
                </ul>

                <input type="hidden" name="emailDomain" value="">
              </div>
              <p class="guide-text" id="emailHelp">도메인 선택 또는 직접 입력 중 하나를 사용하세요.</p>
            </div>

            <!-- 동의 영역 -->
            <div>
              <div class="control checkbox">
                <input type="checkbox" id="check-arg-1" name="marketing-collect" value="Y">
                <label for="check-arg-1">
                  <span class="color-primary">[선택]</span> 마케팅 목적의 개인정보 수집 및 이용 동의
                </label>
              </div>

              <fieldset class="control-group checkbox-group vertical">
                <legend class="field-title">광고성 정보 수신 동의</legend>

                <!-- 전체선택 -->
                <div class="control checkbox">
                  <input type="checkbox" id="chk-all" class="chk-all">
                  <label for="chk-all">
                    <span class="color-primary">[선택]</span> 광고성 정보 수신 동의
                  </label>
                </div>

                <div class="depth2">
                  <!-- 하위 항목 -->
                  <div class="control checkbox">
                    <input type="checkbox" id="chk-email" class="chk-item" name="ad-receive[]" value="email" aria-describedby="adReceiveHelp">
                    <label for="chk-email">이메일 수신 동의</label>
                  </div>

                  <div class="control checkbox">
                    <input type="checkbox" id="chk-sms" class="chk-item" name="ad-receive[]" value="sms" aria-describedby="adReceiveHelp">
                    <label for="chk-sms">SMS, SNS 수신 동의</label>
                  </div>
                </div>
                <p id="adReceiveHelp" class="guide-text">언제든 설정에서 수신 여부를 변경할 수 있습니다.</p>
              </fieldset>
            </div>

            <!-- 제출 -->
            <button type="submit" class="btn btn-primary btn-icon-right size-lg">
              <i class="icon icon-finish" aria-hidden="true"></i>
              완료
            </button>
          </form>
        </div>
      </div>
    </div>
  </section>

</main>

<th:block th:replace="~{component/footer :: siteFooter}"></th:block>
<th:block th:replace="~{component/topBtn :: siteTop}"></th:block>

<!-- Modal -->
<div class="modal" id="alert-1"
    role="alertdialog" aria-modal="true"
    aria-labelledby="alert-1-title" aria-describedby="alert-1-desc"
    aria-hidden="true">
  <div class="modal-overlay" data-modal-close></div>

  <div class="modal-container" role="document" tabindex="-1">
    <header class="modal-header">
      <h2 id="alert-1-title" class="modal-title">마케팅 목적의 개인정보 수집 동의(선택)</h2>
      <button type="button" class="btn btn-darken-line btn-icon-only size-sm modal-close" aria-label="닫기" data-modal-close></button>
    </header>

    <section class="modal-body">
      <div class="gray-box">
        <p class="normal">교통비지원통합포털에서 제공하는 모든 서비스와 향후 출시되는 신규 서비스 전체에 대한 프로모션, 이벤트 광고성 정보의 안내를 위한 개인정보 수집에 동의합니다.</p>
        <div class="table-wrap type-col">
          <table>
            <caption>마케팅 목적의 개인정보 수집 동의 안내</caption>
            <colgroup>
              <col><col><col>
            </colgroup>
            <thead>
              <tr>
                <th>수집∙이용 목적</th>
                <th>개인정보 항목</th>
                <th>보유 및 이용기간</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>교통비지원통합포털에서 제공하는 서비스와 향후 출시되는 서비스에 대한 프로모션, 이벤트 안내</td>
                <td>성명, 이메일 주소, 휴대폰번호</td>
                <td>별도 동의 철회 및 서비스 탈퇴 시 까지</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="color-secondary guide-text">위의 개인정보 수집, 이용에 대한 동의를 거부할 권리가 있습니다. 그러나 동의를 거부할 경우 교통비지원통합포털에서 제공하는 서비스와 향후 출시되는 신규 서비스 전체에 대한 프로모션, 이벤트 등 광고성 정보를 안내 받을 수 없습니다.</p>
      </div>
    </section>

    <footer class="modal-footer">
      <div class="btn-wrap">
        <button type="button" class="btn btn-darken-line size-lg" data-modal-close data-modal-default>
          동의 안함
        </button>
        <button type="button" class="btn btn-primary-line btn-icon-right size-lg" data-modal-close data-modal-default>
          <i class="icon icon-finish"></i>
          동의함
        </button>
      </div>
    </footer>
  </div>
</div>
<!-- Modal2 -->
<div class="modal" id="alert-2"
    role="alertdialog" aria-modal="true"
    aria-labelledby="alert-2-title" aria-describedby="alert-2-desc"
    aria-hidden="true">
  <div class="modal-overlay" data-modal-close></div>

  <div class="modal-container" role="document" tabindex="-1">
    <header class="modal-header">
      <h2 id="alert-1-title" class="modal-title">마케팅 목적의 개인정보 수집 동의(선택)</h2>
      <button type="button" class="btn btn-darken-line btn-icon-only size-sm modal-close" aria-label="닫기" data-modal-close></button>
    </header>

    <section class="modal-body">
      <div class="gray-box">
        <p class="normal">교통비지원통합포털에서 제공하는 모든 서비스와 향후 출시되는 신규 서비스 전체에 대한 프로모션, 이벤트 등 광고성 정보의 안내를 받는 것에 동의합니다.</p>
        <p class="normal">- 안내방법: 문자메시지, 알림톡, 이메일</p>
        <p class="color-secondary guide-text">마케팅 정보 수신 동의 철회는 마이페이지 화면에서 철회가 가능합니다.</p>
      </div>
    </section>

    <footer class="modal-footer">
      <div class="btn-wrap">
        <button type="button" class="btn btn-darken-line size-lg" data-modal-close data-modal-default>
          동의 안함
        </button>
        <button type="button" class="btn btn-primary-line btn-icon-right size-lg" data-modal-close data-modal-default>
          <i class="icon icon-finish"></i>
          동의함
        </button>
      </div>
    </footer>
  </div>
</div>


<script th:src="@{/js/vendor/aos.js}"></script>
<script th:src="@{/js/vendor/gsap.min.js}"></script>
<script th:src="@{/js/vendor/ScrollTrigger.min.js}"></script>
<script th:src="@{/js/vendor/swiper-bundle.min.js}"></script>

<script type="module" th:src="@{/js/common.js}"></script>

<!-- modal체크시 체크박스 체크 -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    /* ==================================================
      공통: OFF → ON 시도만 모달을 띄우는 체크박스 바인더
    ================================================== */
    function bindConsentModal({
      checkbox,
      modal,
      agreeSelector = '.btn-primary-line',
      closeSelector = '[data-modal-close]',
      onAgree,
      onClose
    }) {
      if (!checkbox || !modal) return;

      const label = document.querySelector(`label[for="${checkbox.id}"]`);
      const modalContainer = modal.querySelector('.modal-container');
      if (!modalContainer) return;

      let wasChecked = checkbox.checked;

      const open = () => {
        modal.setAttribute('aria-hidden', 'false');
        modal.classList.add('is-open');
        modalContainer.focus();
      };

      const close = () => {
        modal.setAttribute('aria-hidden', 'true');
        modal.classList.remove('is-open');
      };

      // 🔹 클릭 직전 상태 저장
      const snapshot = () => { wasChecked = checkbox.checked; };
      checkbox.addEventListener('pointerdown', snapshot);
      label?.addEventListener('pointerdown', snapshot);

      // 🔹 클릭 시 분기
      const handleClick = (e) => {
        if (!wasChecked) {        // OFF → ON 시도
          e.preventDefault();
          open();
        }
        // ON → OFF 는 기본 동작 허용
      };

      checkbox.addEventListener('click', handleClick);
      label?.addEventListener('click', handleClick);

      // 🔹 모달 버튼 처리
      modal.addEventListener('click', (e) => {
        const t = e.target;

        if (t.closest(agreeSelector)) {
          onAgree ? onAgree(checkbox) : (checkbox.checked = true);
          close();
          checkbox.focus();
          return;
        }

        if (t.closest(closeSelector)) {
          onClose ? onClose(checkbox) : (checkbox.checked = false);
          close();
          checkbox.focus();
        }
      });
    }

    /* ==================================================
      공통: chk-all ↔ chk-item 그룹 동기화
    ================================================== */
    function bindCheckGroup({ allBox, items, useIndeterminate = true }) {
      if (!allBox || !items || items.length === 0) return;

      const updateAll = () => {
        const allChecked = items.every(el => el.checked);
        const anyChecked = items.some(el => el.checked);

        allBox.checked = allChecked;
        if (useIndeterminate) {
          allBox.indeterminate = anyChecked && !allChecked;
        }
      };

      const setItems = (checked) => {
        items.forEach(el => (el.checked = checked));
        allBox.checked = checked;
        if (useIndeterminate) allBox.indeterminate = false;
      };

      // 실제 상태 변경 후 동기화
      allBox.addEventListener('change', () => setItems(allBox.checked));
      items.forEach(el => el.addEventListener('change', updateAll));

      updateAll();
      return { updateAll, setItems };
    }

    /* ==================================================
      Modal 1 : 단일 체크박스
    ================================================== */
    bindConsentModal({
      checkbox: document.getElementById('check-arg-1'),
      modal: document.getElementById('alert-1')
    });

    /* ==================================================
      Modal 2 : chk-all + chk-item 그룹
    ================================================== */
    const chkAll = document.getElementById('chk-all');
    const items = Array.from(document.querySelectorAll('.chk-item'));
    const modal2 = document.getElementById('alert-2');

    const group = bindCheckGroup({
      allBox: chkAll,
      items,
      useIndeterminate: true
    });

    // 상위 체크박스
    bindConsentModal({
      checkbox: chkAll,
      modal: modal2,
      onAgree: () => {
        group?.setItems(true);
        group?.updateAll();
      },
      onClose: () => {
        group?.setItems(false);
        group?.updateAll();
      }
    });

    // 하위 체크박스들
    items.forEach(item => {
      bindConsentModal({
        checkbox: item,
        modal: modal2,
        onAgree: (cb) => {
          cb.checked = true;
          group?.updateAll();
        },
        onClose: (cb) => {
          cb.checked = false;
          group?.updateAll();
        }
      });
    });
  });
</script>

</body>
</html>
